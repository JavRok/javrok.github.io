!function(r){var n={};function i(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.m=r,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/js/",i(i.s=2)}([function(e,t,r){},function(e,t,r){},function(e,t,r){"use strict";r.r(t);r(0),r(1);function o(e,t){t.appendChild(document.createTextNode(e)),t.appendChild(document.createElement("br"))}var n=function(o,s,c,a){return new(c||(c=Promise))(function(e,t){function r(e){try{i(a.next(e))}catch(e){t(e)}}function n(e){try{i(a.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new c(function(e){e(t.value)}).then(r,n)}i((a=a.apply(o,s||[])).next())})},s=function(r,n){var i,o,s,e,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(s=2&t[0]?o.return:t[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,t[1])).done)return s;switch(o=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,o=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){c.label=t[1];break}if(6===t[0]&&c.label<s[1]){c.label=s[1],s=t;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(t);break}s[2]&&c.ops.pop(),c.trys.pop();continue}t=n.call(r,c)}catch(e){t=[6,e],o=0}finally{i=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},c=document.getElementById("log"),a={audio:!1,video:!0};var i=function(){function e(e){this.hasGetUserMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia),this.hasCameraAccess=!1,this.devices=null,this.currentDevice=-1,this.videoElem=e}return e.prototype.getCameras=function(){return n(this,void 0,void 0,function(){var t;return s(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),this.hasGetUserMedia?[4,navigator.mediaDevices.enumerateDevices()]:(console.log("getUserMedia() is not supported by your browser"),[2,null]);case 1:return t=e.sent(),this.devices=t.filter(function(e){return"videoinput"===e.kind}),[2,this.devices];case 2:return e.sent(),[2,null];case 3:return[2]}})})},e.prototype.getCameraPermission=function(){return n(this,void 0,void 0,function(){var t,r,n,i=this;return s(this,function(e){switch(e.label){case 0:return e.trys.push([0,4,,5]),this.hasGetUserMedia?this.devices?[3,2]:[4,this.getCameras()]:(console.log("getUserMedia() is not supported by your browser"),[2,null]);case 1:e.sent(),e.label=2;case 2:return null===this.devices||0===this.devices.length?(console.log("No cameras available"),o("No cameras available",c),[2,null]):(t={video:{deviceId:{exact:this.devices[0].deviceId}},audio:!1},r=this,[4,navigator.mediaDevices.getUserMedia(t)]);case 3:return r.currentStream=e.sent(),this.currentDevice=0,this.videoElem.srcObject=this.currentStream,this.videoElem.onloadedmetadata=function(){console.log("Video resolution: ",i.videoElem.videoWidth,i.videoElem.videoHeight),i.cameraResolution={width:i.videoElem.videoWidth,height:i.videoElem.videoHeight}},[2,!0];case 4:if(n=e.sent(),console.error("getUserMedia error: "+n.name,n),"ConstraintNotSatisfiedError"===n.name)throw"The constraints are not supported "+a;if("PermissionDeniedError"===n.name)throw"User denied permission to access the camera. Too bad.";return[3,5];case 5:return[2]}})})},e.prototype.stopCurrentStream=function(){this.currentStream&&(this.currentStream.getVideoTracks().forEach(function(e){e.stop()}),this.videoElem.srcObject=null)},e.prototype.selectNextCamera=function(){return n(this,void 0,void 0,function(){var t,r,n,i=this;return s(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),this.hasGetUserMedia?this.devices.length<2?(console.log("There's only one camera, can't switch"),o("There's only one camera, can't switch",c),[2,null]):(o("current Device"+this.currentDevice,c),this.currentDevice=(this.currentDevice+1)%this.devices.length,o("current Device after"+this.currentDevice+" id: "+this.devices[this.currentDevice].deviceId,c),t={video:{deviceId:{exact:this.devices[this.currentDevice].deviceId}},audio:!1},this.stopCurrentStream(),r=this,[4,navigator.mediaDevices.getUserMedia(t)]):(console.log("getUserMedia() is not supported by your browser"),[2,null]);case 1:return r.currentStream=e.sent(),this.videoElem.srcObject=this.currentStream,this.videoElem.onloadedmetadata=function(){console.log("Video resolution: ",i.videoElem.videoWidth,i.videoElem.videoHeight),i.cameraResolution={width:i.videoElem.videoWidth,height:i.videoElem.videoHeight}},[2,!0];case 2:if(n=e.sent(),console.error("getUserMedia error: "+n.name,n),o("ERR "+n,c),"ConstraintNotSatisfiedError"===n.name)throw"The constraints are not supported "+a;if("PermissionDeniedError"===n.name)throw"User denied permission to access the camera. Too bad.";return[3,3];case 3:return[2]}})})},e}(),u=function(o,s,c,a){return new(c||(c=Promise))(function(e,t){function r(e){try{i(a.next(e))}catch(e){t(e)}}function n(e){try{i(a.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new c(function(e){e(t.value)}).then(r,n)}i((a=a.apply(o,s||[])).next())})},l=function(r,n){var i,o,s,e,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(s=2&t[0]?o.return:t[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,t[1])).done)return s;switch(o=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,o=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){c.label=t[1];break}if(6===t[0]&&c.label<s[1]){c.label=s[1],s=t;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(t);break}s[2]&&c.ops.pop(),c.trys.pop();continue}t=n.call(r,c)}catch(e){t=[6,e],o=0}finally{i=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},d=document.querySelector(".video"),h=document.getElementById("log"),f=document.querySelector(".switch-camera");!function(){u(this,void 0,void 0,function(){var t,r,n=this;return l(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,(t=new i(d)).getCameraPermission()];case 1:return e.sent(),f.addEventListener("click",function(e){return u(n,void 0,void 0,function(){return l(this,function(e){switch(e.label){case 0:return[4,t.selectNextCamera()];case 1:return e.sent(),[2]}})})}),[3,3];case 2:return r=e.sent(),console.log(r),o("exc"+r,h),[3,3];case 3:return[2]}})})}()}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2pzL2hlbHBlcnMudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2pzL01lZGlhQWNjZXNzLnRzIiwid2VicGFjazovLy8uL3NyYy9qcy9pbmRleC50cyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsImxvZ1RvRG9tIiwidGV4dCIsImVsZW0iLCJhcHBlbmRDaGlsZCIsImRvY3VtZW50IiwiY3JlYXRlVGV4dE5vZGUiLCJjcmVhdGVFbGVtZW50IiwibG9nVGV4dCIsImdldEVsZW1lbnRCeUlkIiwiY29uc3RyYWludHMiLCJhdWRpbyIsInZpZGVvIiwiTWVkaWFBY2Nlc3NfTWVkaWFBY2Nlc3MiLCJNZWRpYUFjY2VzcyIsInRoaXMiLCJoYXNHZXRVc2VyTWVkaWEiLCJuYXZpZ2F0b3IiLCJtZWRpYURldmljZXMiLCJnZXRVc2VyTWVkaWEiLCJoYXNDYW1lcmFBY2Nlc3MiLCJkZXZpY2VzIiwiY3VycmVudERldmljZSIsInZpZGVvRWxlbSIsImdldENhbWVyYXMiLCJlbnVtZXJhdGVEZXZpY2VzIiwiY29uc29sZSIsImxvZyIsIl9hIiwic2VudCIsImZpbHRlciIsImRldmljZSIsImtpbmQiLCJnZXRDYW1lcmFQZXJtaXNzaW9uIiwiX2IiLCJsZW5ndGgiLCJjb25zdHJhaW50c18xIiwiZGV2aWNlSWQiLCJleGFjdCIsImN1cnJlbnRTdHJlYW0iLCJzcmNPYmplY3QiLCJvbmxvYWRlZG1ldGFkYXRhIiwiX3RoaXMiLCJ2aWRlb1dpZHRoIiwidmlkZW9IZWlnaHQiLCJjYW1lcmFSZXNvbHV0aW9uIiwid2lkdGgiLCJoZWlnaHQiLCJlcnJvciIsImVycl8xIiwic3RvcEN1cnJlbnRTdHJlYW0iLCJnZXRWaWRlb1RyYWNrcyIsImZvckVhY2giLCJ0cmFjayIsInN0b3AiLCJzZWxlY3ROZXh0Q2FtZXJhIiwiY29uc3RyYWludHNfMiIsImVycl8yIiwicXVlcnlTZWxlY3RvciIsImpzX2xvZ1RleHQiLCJjYW1lcmFTd2l0Y2hCdG4iLCJtZWRpYUFjY2Vzc18xIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2dCIsImpzX2F3YWl0ZXIiLCJlXzEiLCJzdGFydCJdLCJtYXBwaW5ncyI6ImFBQ0EsSUFBQUEsRUFBQSxHQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBQyxRQUdBLElBQUFDLEVBQUFKLEVBQUFFLEdBQUEsQ0FDQUcsRUFBQUgsRUFDQUksR0FBQSxFQUNBSCxRQUFBLElBVUEsT0FOQUksRUFBQUwsR0FBQU0sS0FBQUosRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUYsR0FHQUcsRUFBQUUsR0FBQSxFQUdBRixFQUFBRCxRQUtBRixFQUFBUSxFQUFBRixFQUdBTixFQUFBUyxFQUFBVixFQUdBQyxFQUFBVSxFQUFBLFNBQUFSLEVBQUFTLEVBQUFDLEdBQ0FaLEVBQUFhLEVBQUFYLEVBQUFTLElBQ0FHLE9BQUFDLGVBQUFiLEVBQUFTLEVBQUEsQ0FBMENLLFlBQUEsRUFBQUMsSUFBQUwsS0FLMUNaLEVBQUFrQixFQUFBLFNBQUFoQixHQUNBLG9CQUFBaUIsZUFBQUMsYUFDQU4sT0FBQUMsZUFBQWIsRUFBQWlCLE9BQUFDLFlBQUEsQ0FBd0RDLE1BQUEsV0FFeERQLE9BQUFDLGVBQUFiLEVBQUEsY0FBaURtQixPQUFBLEtBUWpEckIsRUFBQXNCLEVBQUEsU0FBQUQsRUFBQUUsR0FFQSxHQURBLEVBQUFBLElBQUFGLEVBQUFyQixFQUFBcUIsSUFDQSxFQUFBRSxFQUFBLE9BQUFGLEVBQ0EsS0FBQUUsR0FBQSxpQkFBQUYsUUFBQUcsV0FBQSxPQUFBSCxFQUNBLElBQUFJLEVBQUFYLE9BQUFZLE9BQUEsTUFHQSxHQUZBMUIsRUFBQWtCLEVBQUFPLEdBQ0FYLE9BQUFDLGVBQUFVLEVBQUEsV0FBeUNULFlBQUEsRUFBQUssVUFDekMsRUFBQUUsR0FBQSxpQkFBQUYsRUFBQSxRQUFBTSxLQUFBTixFQUFBckIsRUFBQVUsRUFBQWUsRUFBQUUsRUFBQSxTQUFBQSxHQUFnSCxPQUFBTixFQUFBTSxJQUFxQkMsS0FBQSxLQUFBRCxJQUNySSxPQUFBRixHQUlBekIsRUFBQTZCLEVBQUEsU0FBQTFCLEdBQ0EsSUFBQVMsRUFBQVQsS0FBQXFCLFdBQ0EsV0FBMkIsT0FBQXJCLEVBQUEsU0FDM0IsV0FBaUMsT0FBQUEsR0FFakMsT0FEQUgsRUFBQVUsRUFBQUUsRUFBQSxJQUFBQSxHQUNBQSxHQUlBWixFQUFBYSxFQUFBLFNBQUFpQixFQUFBQyxHQUFzRCxPQUFBakIsT0FBQWtCLFVBQUFDLGVBQUExQixLQUFBdUIsRUFBQUMsSUFHdEQvQixFQUFBa0MsRUFBQSxPQUlBbEMsSUFBQW1DLEVBQUEsdUZDbEZPLFNBQVNDLEVBQVNDLEVBQWNDLEdBQ25DQSxFQUFLQyxZQUFZQyxTQUFTQyxlQUFlSixJQUN6Q0MsRUFBS0MsWUFBWUMsU0FBU0UsY0FBYyx1ekNDQXRDQyxFQUFVSCxTQUFTSSxlQUFlLE9BRWxDQyxFQUFjLENBQ2hCQyxPQUFPLEVBQ1BDLE9BQU8sR0FPWCxJQUFBQyxFQUFBLFdBaUJJLFNBQUFDLEVBQW1CRixHQUNmRyxLQUFLQyxtQkFBcUJDLFVBQVVDLGVBQWdCRCxVQUFVQyxhQUFhQyxjQUMzRUosS0FBS0ssaUJBQWtCLEVBQ3ZCTCxLQUFLTSxRQUFVLEtBQ2ZOLEtBQUtPLGVBQWlCLEVBQ3RCUCxLQUFLUSxVQUFZWCxFQWdJekIsT0E3SGlCRSxFQUFBakIsVUFBQTJCLFdBQWIseUdBRVEsNkJBQUtULEtBQUtDLGdCQUtNLEdBQU1DLFVBQVVDLGFBQWFPLHFCQUp6Q0MsUUFBUUMsSUFBSSxtREFDWixHQUFPLGNBS1gsT0FGTU4sRUFBVU8sRUFBQUMsT0FDaEJkLEtBQUtNLFFBQVVBLEVBQVFTLE9BQU8sU0FBQUMsR0FBVSxNQUFnQixlQUFoQkEsRUFBT0MsT0FDL0MsR0FBT2pCLEtBQUtNLGdCQUVaLG1CQUFPLDZCQU9GUCxFQUFBakIsVUFBQW9DLG9CQUFiLG9IQUVRLDZCQUFLbEIsS0FBS0MsZ0JBS0xELEtBQUtNLFFBQU4sTUFDQSxHQUFNTixLQUFLUyxlQUxYRSxRQUFRQyxJQUFJLG1EQUNaLEdBQU8sY0FJUE8sRUFBQUwsd0JBRUosT0FBcUIsT0FBakJkLEtBQUtNLFNBQTRDLElBQXhCTixLQUFLTSxRQUFRYyxRQUN0Q1QsUUFBUUMsSUFBSSx3QkFDWjFCLEVBQVMsdUJBQXdCTyxHQUNqQyxHQUFPLFFBSUw0QixFQUFjLENBQ2hCeEIsTUFBTyxDQUNIeUIsU0FBVSxDQUNOQyxNQUFPdkIsS0FBS00sUUFBUSxHQUFHZ0IsV0FHL0IxQixPQUFPLEdBR1hpQixFQUFBYixLQUFxQixHQUFNRSxVQUFVQyxhQUFhQyxhQUFhaUIsWUFTL0QsT0FUQVIsRUFBS1csY0FBZ0JMLEVBQUFMLE9BQ3JCZCxLQUFLTyxjQUFnQixFQUVyQlAsS0FBS1EsVUFBVWlCLFVBQVl6QixLQUFLd0IsY0FFaEN4QixLQUFLUSxVQUFVa0IsaUJBQW1CLFdBQzlCZixRQUFRQyxJQUFJLHFCQUFzQmUsRUFBS25CLFVBQVVvQixXQUFZRCxFQUFLbkIsVUFBVXFCLGFBQzVFRixFQUFLRyxpQkFBbUIsQ0FBRUMsTUFBT0osRUFBS25CLFVBQVVvQixXQUFZSSxPQUFRTCxFQUFLbkIsVUFBVXFCLGNBRXZGLElBQU8sVUFHUCxjQURBbEIsUUFBUXNCLE1BQU0sdUJBQXlCQyxFQUFJekUsS0FBTXlFLEdBQ2hDLGdDQUFiQSxFQUFJekUsS0FDSixLQUFNLHFDQUF1Q2tDLEVBQzFDLEdBQWlCLDBCQUFidUMsRUFBSXpFLEtBQ1gsS0FBTSwyRkFRWHNDLEVBQUFqQixVQUFBcUQsa0JBQVAsV0FDUW5DLEtBQUt3QixnQkFDTHhCLEtBQUt3QixjQUFjWSxpQkFBaUJDLFFBQVEsU0FBQUMsR0FDeENBLEVBQU1DLFNBRVZ2QyxLQUFLUSxVQUFVaUIsVUFBWSxPQUl0QjFCLEVBQUFqQixVQUFBMEQsaUJBQWIsb0hBRVEsNkJBQUt4QyxLQUFLQyxnQkFJTkQsS0FBS00sUUFBUWMsT0FBUyxHQUN0QlQsUUFBUUMsSUFBSSx5Q0FDWjFCLEVBQVMsd0NBQXlDTyxHQUNsRCxHQUFPLFFBSVhQLEVBQVMsaUJBQW1CYyxLQUFLTyxjQUFlZCxHQUNoRE8sS0FBS08sZUFBaUJQLEtBQUtPLGNBQWdCLEdBQUtQLEtBQUtNLFFBQVFjLE9BQzdEbEMsRUFDSSx1QkFBeUJjLEtBQUtPLGNBQWdCLFFBQVVQLEtBQUtNLFFBQVFOLEtBQUtPLGVBQWVlLFNBQ3pGN0IsR0FHRWdELEVBQWMsQ0FDaEI1QyxNQUFPLENBQ0h5QixTQUFVLENBQ05DLE1BQU92QixLQUFLTSxRQUFRTixLQUFLTyxlQUFlZSxXQUdoRDFCLE9BQU8sR0FFWEksS0FBS21DLG9CQUNMdEIsRUFBQWIsS0FBcUIsR0FBTUUsVUFBVUMsYUFBYUMsYUFBYXFDLE1BMUIzRDlCLFFBQVFDLElBQUksbURBQ1osR0FBTyxjQWlDWCxPQVJBQyxFQUFLVyxjQUFnQkwsRUFBQUwsT0FFckJkLEtBQUtRLFVBQVVpQixVQUFZekIsS0FBS3dCLGNBRWhDeEIsS0FBS1EsVUFBVWtCLGlCQUFtQixXQUM5QmYsUUFBUUMsSUFBSSxxQkFBc0JlLEVBQUtuQixVQUFVb0IsV0FBWUQsRUFBS25CLFVBQVVxQixhQUM1RUYsRUFBS0csaUJBQW1CLENBQUVDLE1BQU9KLEVBQUtuQixVQUFVb0IsV0FBWUksT0FBUUwsRUFBS25CLFVBQVVxQixjQUV2RixJQUFPLFVBS1AsY0FIQWxCLFFBQVFzQixNQUFNLHVCQUF5QlMsRUFBSWpGLEtBQU1pRixHQUNqRHhELEVBQVMsT0FBU3dELEVBQUtqRCxHQUVOLGdDQUFiaUQsRUFBSWpGLEtBQ0osS0FBTSxxQ0FBdUNrQyxFQUMxQyxHQUFpQiwwQkFBYitDLEVBQUlqRixLQUNYLEtBQU0sMkZBSXRCc0MsRUF0SkEsK3lDQ05NRixFQUEwQlAsU0FBU3FELGNBQWMsVUFDakRDLEVBQVV0RCxTQUFTSSxlQUFlLE9BQ2xDbUQsRUFBK0J2RCxTQUFTcUQsY0FBYyxtQkFFNUQsMkdBRzJCLGlDQURiRyxFQUFjLElBQUloRCxFQUFZRCxJQUNDcUIscUNBQWxCTCxFQUFBQyxPQUVuQitCLEVBQWdCRSxpQkFBaUIsUUFBUyxTQUFNQyxHQUFHLE9BQUFDLEVBQUF0QixPQUFBLHFFQUUvQyxTQUFNbUIsRUFBWU4sa0NBQWxCM0IsRUFBQUMsaURBR0pILFFBQVFDLElBQUlzQyxHQUNaaEUsRUFBUyxNQUFRZ0UsRUFBR04sK0JBSTVCTyIsImZpbGUiOiJlbW9qaWJvZHkuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIi9qcy9cIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDIpO1xuIiwiZXhwb3J0IGZ1bmN0aW9uIGxvZ1RvRG9tKHRleHQ6IHN0cmluZywgZWxlbTogSFRNTEVsZW1lbnQpIHtcclxuICAgIGVsZW0uYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGV4dCkpO1xyXG4gICAgZWxlbS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdicicpKTtcclxufVxyXG4iLCJpbXBvcnQgeyBsb2dUb0RvbSB9IGZyb20gJy4vaGVscGVycyc7XHJcblxyXG5jb25zdCBsb2dUZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZycpO1xyXG5cclxuY29uc3QgY29uc3RyYWludHMgPSB7XHJcbiAgICBhdWRpbzogZmFsc2UsXHJcbiAgICB2aWRlbzogdHJ1ZSxcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBoYXNHZXRVc2VyTWVkaWEoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gISEobmF2aWdhdG9yLm1lZGlhRGV2aWNlcyAmJiBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSk7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBNZWRpYUFjY2VzcyB7XHJcbiAgICAvLyBUcnVlIGlmIGJyb3dzZXIgaXMgY29tcGF0aWJsZVxyXG4gICAgcHVibGljIGhhc0dldFVzZXJNZWRpYTogYm9vbGVhbjtcclxuICAgIC8vIFRydWUgaXMgdXNlciBoYXMgZ3JhbnRlZCBhY2Nlc3NcclxuICAgIHB1YmxpYyBoYXNDYW1lcmFBY2Nlc3M6IGJvb2xlYW47XHJcblxyXG4gICAgLy8gTGlzdCBvZiBjYW1lcmFzIGF2YWlsYWJsZVxyXG4gICAgcHJpdmF0ZSBkZXZpY2VzOiBhbnlbXTtcclxuICAgIC8vIEluZGV4IG9mIHRoZSBhY3RpdmUgY2FtZXJhXHJcbiAgICBwcml2YXRlIGN1cnJlbnREZXZpY2U6IG51bWJlcjtcclxuICAgIC8vIEN1cnJlbnQgY2FtZXJhIHJlc29sdXRpb24sIG9ubHkgYXZhaWxhYmxlIHVudGlsIHN0cmVhbSBpcyBwYXNzZWQgdG8gPHZpZGVvPiBlbGVtZW50XHJcbiAgICBwcml2YXRlIGNhbWVyYVJlc29sdXRpb246IHsgd2lkdGg6IG51bWJlcjsgaGVpZ2h0OiBudW1iZXIgfTtcclxuICAgIC8vIEN1cnJlbnQgYWN0aXZlIGNhbWVyYSBzdHJlYW1cclxuICAgIHByaXZhdGUgY3VycmVudFN0cmVhbTogTWVkaWFTdHJlYW07XHJcbiAgICAvLyBWaWRlbyBIVE1MIGVsZW1lbnQgaW4gd2hpY2ggdG8gb3V0cHV0IHRoZSBzdHJlYW1cclxuICAgIHByaXZhdGUgdmlkZW9FbGVtOiBIVE1MVmlkZW9FbGVtZW50O1xyXG5cclxuICAgIHB1YmxpYyBjb25zdHJ1Y3Rvcih2aWRlbzogSFRNTFZpZGVvRWxlbWVudCkge1xyXG4gICAgICAgIHRoaXMuaGFzR2V0VXNlck1lZGlhID0gISEobmF2aWdhdG9yLm1lZGlhRGV2aWNlcyAmJiBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSk7XHJcbiAgICAgICAgdGhpcy5oYXNDYW1lcmFBY2Nlc3MgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmRldmljZXMgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuY3VycmVudERldmljZSA9IC0xO1xyXG4gICAgICAgIHRoaXMudmlkZW9FbGVtID0gdmlkZW87XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGFzeW5jIGdldENhbWVyYXMoKTogUHJvbWlzZTxhbnk+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuaGFzR2V0VXNlck1lZGlhKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZ2V0VXNlck1lZGlhKCkgaXMgbm90IHN1cHBvcnRlZCBieSB5b3VyIGJyb3dzZXInKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBkZXZpY2VzID0gYXdhaXQgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5lbnVtZXJhdGVEZXZpY2VzKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZGV2aWNlcyA9IGRldmljZXMuZmlsdGVyKGRldmljZSA9PiBkZXZpY2Uua2luZCA9PT0gJ3ZpZGVvaW5wdXQnKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGV2aWNlcztcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKlxyXG4gICAgICogQXNrcyB0aGUgdXNlciBmb3IgYWNjZXNzIHRvIHRoZSBjYW1lcmEocykuIElmIGdyYW50ZWQsIHNlbGVjdHMgdGhlIDFzdCBjYW1lcmEgaW4gdGhlIGxpc3Qgb2YgZGV2aWNlcy5cclxuICAgICAqL1xyXG4gICAgcHVibGljIGFzeW5jIGdldENhbWVyYVBlcm1pc3Npb24oKTogUHJvbWlzZTxhbnk+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuaGFzR2V0VXNlck1lZGlhKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZ2V0VXNlck1lZGlhKCkgaXMgbm90IHN1cHBvcnRlZCBieSB5b3VyIGJyb3dzZXInKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuZGV2aWNlcykge1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5nZXRDYW1lcmFzKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuZGV2aWNlcyA9PT0gbnVsbCB8fCB0aGlzLmRldmljZXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnTm8gY2FtZXJhcyBhdmFpbGFibGUnKTtcclxuICAgICAgICAgICAgICAgIGxvZ1RvRG9tKCdObyBjYW1lcmFzIGF2YWlsYWJsZScsIGxvZ1RleHQpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFNlbGVjdCAxc3QgY2FtZXJhIGluIGxpc3Qgb2YgZGV2aWNlc1xyXG4gICAgICAgICAgICBjb25zdCBjb25zdHJhaW50cyA9IHtcclxuICAgICAgICAgICAgICAgIHZpZGVvOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGV2aWNlSWQ6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXhhY3Q6IHRoaXMuZGV2aWNlc1swXS5kZXZpY2VJZCxcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGF1ZGlvOiBmYWxzZSxcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFN0cmVhbSA9IGF3YWl0IG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKGNvbnN0cmFpbnRzKTtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50RGV2aWNlID0gMDtcclxuICAgICAgICAgICAgLy8gKHdpbmRvdyBhcyBhbnkpLnN0cmVhbSA9IGN1cnJlbnRTdHJlYW07IC8vIG1ha2UgdmFyaWFibGUgYXZhaWxhYmxlIHRvIGJyb3dzZXIgY29uc29sZVxyXG4gICAgICAgICAgICB0aGlzLnZpZGVvRWxlbS5zcmNPYmplY3QgPSB0aGlzLmN1cnJlbnRTdHJlYW07XHJcbiAgICAgICAgICAgIC8vIFdlIGNhbiBvbmx5IGtub3cgdGhlIHJlc29sdXRpb24gd2hlbiB3ZSBwYXNzIHRoZSBzdHJlYW0gdG8gdGhlIDx2aWRlbz4gZWxlbWVudFxyXG4gICAgICAgICAgICB0aGlzLnZpZGVvRWxlbS5vbmxvYWRlZG1ldGFkYXRhID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1ZpZGVvIHJlc29sdXRpb246ICcsIHRoaXMudmlkZW9FbGVtLnZpZGVvV2lkdGgsIHRoaXMudmlkZW9FbGVtLnZpZGVvSGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2FtZXJhUmVzb2x1dGlvbiA9IHsgd2lkdGg6IHRoaXMudmlkZW9FbGVtLnZpZGVvV2lkdGgsIGhlaWdodDogdGhpcy52aWRlb0VsZW0udmlkZW9IZWlnaHQgfTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ2dldFVzZXJNZWRpYSBlcnJvcjogJyArIGVyci5uYW1lLCBlcnIpO1xyXG4gICAgICAgICAgICBpZiAoZXJyLm5hbWUgPT09ICdDb25zdHJhaW50Tm90U2F0aXNmaWVkRXJyb3InKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyAnVGhlIGNvbnN0cmFpbnRzIGFyZSBub3Qgc3VwcG9ydGVkICcgKyBjb25zdHJhaW50cztcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChlcnIubmFtZSA9PT0gJ1Blcm1pc3Npb25EZW5pZWRFcnJvcicpIHtcclxuICAgICAgICAgICAgICAgIHRocm93ICdVc2VyIGRlbmllZCBwZXJtaXNzaW9uIHRvIGFjY2VzcyB0aGUgY2FtZXJhLiBUb28gYmFkLic7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLypcclxuICAgICAqIE5lZWRlZCBkZWluaXRpYWxpemF0aW9uIGZvciBjYW1lcmEgc3dpdGNoXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdG9wQ3VycmVudFN0cmVhbSgpIHtcclxuICAgICAgICBpZiAodGhpcy5jdXJyZW50U3RyZWFtKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFN0cmVhbS5nZXRWaWRlb1RyYWNrcygpLmZvckVhY2godHJhY2sgPT4ge1xyXG4gICAgICAgICAgICAgICAgdHJhY2suc3RvcCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy52aWRlb0VsZW0uc3JjT2JqZWN0ID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGFzeW5jIHNlbGVjdE5leHRDYW1lcmEoKTogUHJvbWlzZTxhbnk+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuaGFzR2V0VXNlck1lZGlhKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZ2V0VXNlck1lZGlhKCkgaXMgbm90IHN1cHBvcnRlZCBieSB5b3VyIGJyb3dzZXInKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRldmljZXMubGVuZ3RoIDwgMikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJUaGVyZSdzIG9ubHkgb25lIGNhbWVyYSwgY2FuJ3Qgc3dpdGNoXCIpO1xyXG4gICAgICAgICAgICAgICAgbG9nVG9Eb20oXCJUaGVyZSdzIG9ubHkgb25lIGNhbWVyYSwgY2FuJ3Qgc3dpdGNoXCIsIGxvZ1RleHQpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIE5leHQgY2FtZXJhIGF2YWlsYWJsZVxyXG4gICAgICAgICAgICBsb2dUb0RvbSgnY3VycmVudCBEZXZpY2UnICsgdGhpcy5jdXJyZW50RGV2aWNlLCBsb2dUZXh0KTtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50RGV2aWNlID0gKHRoaXMuY3VycmVudERldmljZSArIDEpICUgdGhpcy5kZXZpY2VzLmxlbmd0aDtcclxuICAgICAgICAgICAgbG9nVG9Eb20oXHJcbiAgICAgICAgICAgICAgICAnY3VycmVudCBEZXZpY2UgYWZ0ZXInICsgdGhpcy5jdXJyZW50RGV2aWNlICsgJyBpZDogJyArIHRoaXMuZGV2aWNlc1t0aGlzLmN1cnJlbnREZXZpY2VdLmRldmljZUlkLFxyXG4gICAgICAgICAgICAgICAgbG9nVGV4dCxcclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnN0cmFpbnRzID0ge1xyXG4gICAgICAgICAgICAgICAgdmlkZW86IHtcclxuICAgICAgICAgICAgICAgICAgICBkZXZpY2VJZDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBleGFjdDogdGhpcy5kZXZpY2VzW3RoaXMuY3VycmVudERldmljZV0uZGV2aWNlSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBhdWRpbzogZmFsc2UsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMuc3RvcEN1cnJlbnRTdHJlYW0oKTtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50U3RyZWFtID0gYXdhaXQgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoY29uc3RyYWludHMpO1xyXG4gICAgICAgICAgICAvLyAod2luZG93IGFzIGFueSkuc3RyZWFtID0gY3VycmVudFN0cmVhbTsgLy8gbWFrZSB2YXJpYWJsZSBhdmFpbGFibGUgdG8gYnJvd3NlciBjb25zb2xlXHJcbiAgICAgICAgICAgIHRoaXMudmlkZW9FbGVtLnNyY09iamVjdCA9IHRoaXMuY3VycmVudFN0cmVhbTtcclxuICAgICAgICAgICAgLy8gV2UgY2FuIG9ubHkga25vdyB0aGUgcmVzb2x1dGlvbiB3aGVuIHdlIHBhc3MgdGhlIHN0cmVhbSB0byB0aGUgPHZpZGVvPiBlbGVtZW50XHJcbiAgICAgICAgICAgIHRoaXMudmlkZW9FbGVtLm9ubG9hZGVkbWV0YWRhdGEgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnVmlkZW8gcmVzb2x1dGlvbjogJywgdGhpcy52aWRlb0VsZW0udmlkZW9XaWR0aCwgdGhpcy52aWRlb0VsZW0udmlkZW9IZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jYW1lcmFSZXNvbHV0aW9uID0geyB3aWR0aDogdGhpcy52aWRlb0VsZW0udmlkZW9XaWR0aCwgaGVpZ2h0OiB0aGlzLnZpZGVvRWxlbS52aWRlb0hlaWdodCB9O1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignZ2V0VXNlck1lZGlhIGVycm9yOiAnICsgZXJyLm5hbWUsIGVycik7XHJcbiAgICAgICAgICAgIGxvZ1RvRG9tKCdFUlIgJyArIGVyciwgbG9nVGV4dCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoZXJyLm5hbWUgPT09ICdDb25zdHJhaW50Tm90U2F0aXNmaWVkRXJyb3InKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyAnVGhlIGNvbnN0cmFpbnRzIGFyZSBub3Qgc3VwcG9ydGVkICcgKyBjb25zdHJhaW50cztcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChlcnIubmFtZSA9PT0gJ1Blcm1pc3Npb25EZW5pZWRFcnJvcicpIHtcclxuICAgICAgICAgICAgICAgIHRocm93ICdVc2VyIGRlbmllZCBwZXJtaXNzaW9uIHRvIGFjY2VzcyB0aGUgY2FtZXJhLiBUb28gYmFkLic7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbi8vIGxldCBjdXJyZW50U3RyZWFtO1xyXG4vL1xyXG4vLyBleHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q2FtZXJhcygpOiBQcm9taXNlPGFueT4ge1xyXG4vLyAgICAgdHJ5IHtcclxuLy8gICAgICAgICBpZiAoIWhhc0dldFVzZXJNZWRpYSgpKSB7XHJcbi8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdnZXRVc2VyTWVkaWEoKSBpcyBub3Qgc3VwcG9ydGVkIGJ5IHlvdXIgYnJvd3NlcicpO1xyXG4vLyAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuLy8gICAgICAgICB9XHJcbi8vICAgICAgICAgY29uc3QgZGV2aWNlcyA9IGF3YWl0IG5hdmlnYXRvci5tZWRpYURldmljZXMuZW51bWVyYXRlRGV2aWNlcygpO1xyXG4vLyAgICAgICAgIHJldHVybiBkZXZpY2VzLmZpbHRlcihkZXZpY2UgPT4gZGV2aWNlLmtpbmQgPT09ICd2aWRlb2lucHV0Jyk7XHJcbi8vICAgICB9IGNhdGNoIChlKSB7XHJcbi8vICAgICAgICAgcmV0dXJuIG51bGw7XHJcbi8vICAgICB9XHJcbi8vIH1cclxuLy9cclxuLy8gZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENhbWVyYVBlcm1pc3Npb24oZGV2aWNlSWQ6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XHJcbi8vICAgICB0cnkge1xyXG4vLyAgICAgICAgIGxvZ1RvRG9tKCdnZXRDYW1lcmFQZXJtaXNzaW9uJywgbG9nVGV4dCk7XHJcbi8vICAgICAgICAgaWYgKCFoYXNHZXRVc2VyTWVkaWEoKSkge1xyXG4vLyAgICAgICAgICAgICBjb25zb2xlLmxvZygnZ2V0VXNlck1lZGlhKCkgaXMgbm90IHN1cHBvcnRlZCBieSB5b3VyIGJyb3dzZXInKTtcclxuLy8gICAgICAgICAgICAgbG9nVG9Eb20oJ2dldFVzZXJNZWRpYSgpIGlzIG5vdCBzdXBwb3J0ZWQgYnkgeW91ciBicm93c2VyJywgbG9nVGV4dCk7XHJcbi8vICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4vLyAgICAgICAgIH1cclxuLy8gICAgICAgICBsb2dUb0RvbSgnZ2V0Q2FtZXJhUGVybWlzc2lvbjInLCBsb2dUZXh0KTtcclxuLy9cclxuLy8gICAgICAgICBjb25zdCBjb25zdHJhaW50cyA9IHtcclxuLy8gICAgICAgICAgICAgdmlkZW86IHtcclxuLy8gICAgICAgICAgICAgICAgIGRldmljZUlkOiB7XHJcbi8vICAgICAgICAgICAgICAgICAgICAgZXhhY3Q6IGRldmljZUlkLFxyXG4vLyAgICAgICAgICAgICAgICAgfSxcclxuLy8gICAgICAgICAgICAgfSxcclxuLy8gICAgICAgICAgICAgYXVkaW86IGZhbHNlLFxyXG4vLyAgICAgICAgIH07XHJcbi8vICAgICAgICAgY3VycmVudFN0cmVhbSA9IGF3YWl0IG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKGNvbnN0cmFpbnRzKTtcclxuLy8gICAgICAgICBsb2dUb0RvbSgnZ2V0Q2FtZXJhUGVybWlzc2lvbjMnLCBsb2dUZXh0KTtcclxuLy9cclxuLy8gICAgICAgICBsb2dUb0RvbSgnY3VycmVudFN0cmVhbScsIGxvZ1RleHQpO1xyXG4vLyAgICAgICAgICh3aW5kb3cgYXMgYW55KS5zdHJlYW0gPSBjdXJyZW50U3RyZWFtOyAvLyBtYWtlIHZhcmlhYmxlIGF2YWlsYWJsZSB0byBicm93c2VyIGNvbnNvbGVcclxuLy8gICAgICAgICB2aWRlby5zcmNPYmplY3QgPSBjdXJyZW50U3RyZWFtO1xyXG4vLyAgICAgICAgIC8vIFdlIGNhbiBvbmx5IGtub3cgdGhlIHJlc29sdXRpb24gd2hlbiB3ZSBwYXNzIHRoZSBzdHJlYW0gdG8gdGhlIDx2aWRlbz4gZWxlbWVudFxyXG4vLyAgICAgICAgIHZpZGVvLm9ubG9hZGVkbWV0YWRhdGEgPSAoKSA9PiB7XHJcbi8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdHT1QgSVQgIGFzZCAhJywgdmlkZW8udmlkZW9XaWR0aCwgdmlkZW8udmlkZW9IZWlnaHQpO1xyXG4vLyAgICAgICAgIH07XHJcbi8vICAgICAgICAgbG9nVG9Eb20oJ3JldHVybiB0cnVlJywgbG9nVGV4dCk7XHJcbi8vICAgICAgICAgcmV0dXJuIHRydWU7XHJcbi8vICAgICB9IGNhdGNoIChlcnIpIHtcclxuLy8gICAgICAgICBjb25zb2xlLmVycm9yKCdnZXRVc2VyTWVkaWEgZXJyb3I6ICcgKyBlcnIubmFtZSwgZXJyKTtcclxuLy8gICAgICAgICBpZiAoZXJyLm5hbWUgPT09ICdDb25zdHJhaW50Tm90U2F0aXNmaWVkRXJyb3InKSB7XHJcbi8vICAgICAgICAgICAgIHRocm93ICdUaGUgY29uc3RyYWludHMgYXJlIG5vdCBzdXBwb3J0ZWQgJyArIGNvbnN0cmFpbnRzO1xyXG4vLyAgICAgICAgIH0gZWxzZSBpZiAoZXJyLm5hbWUgPT09ICdQZXJtaXNzaW9uRGVuaWVkRXJyb3InKSB7XHJcbi8vICAgICAgICAgICAgIHRocm93ICdVc2VyIGRlbmllZCBwZXJtaXNzaW9uIHRvIGFjY2VzcyB0aGUgY2FtZXJhLiBUb28gYmFkLic7XHJcbi8vICAgICAgICAgfVxyXG4vLyAgICAgfVxyXG4vLyB9XHJcblxyXG4vLyBpZiAoaGFzR2V0VXNlck1lZGlhKCkpIHtcclxuLy8gICAgIG5hdmlnYXRvci5tZWRpYURldmljZXNcclxuLy8gICAgICAgICAuZ2V0VXNlck1lZGlhKGNvbnN0cmFpbnRzKVxyXG4vLyAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHN0cmVhbSkge1xyXG4vLyAgICAgICAgICAgICBjdXJyZW50U3RyZWFtID0gc3RyZWFtO1xyXG4vLyAgICAgICAgICAgICAod2luZG93IGFzIGFueSkuc3RyZWFtID0gc3RyZWFtOyAvLyBtYWtlIHZhcmlhYmxlIGF2YWlsYWJsZSB0byBicm93c2VyIGNvbnNvbGVcclxuLy8gICAgICAgICAgICAgdmlkZW8uc3JjT2JqZWN0ID0gc3RyZWFtO1xyXG4vLyAgICAgICAgICAgICB2aWRlby5vbmxvYWRlZG1ldGFkYXRhID0gKCkgPT4ge1xyXG4vLyAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0dPVCBJVCAhJywgdmlkZW8udmlkZW9XaWR0aCwgdmlkZW8udmlkZW9IZWlnaHQpO1xyXG4vLyAgICAgICAgICAgICB9O1xyXG4vLyAgICAgICAgIH0pXHJcbi8vICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7XHJcbi8vICAgICAgICAgICAgIGlmIChlcnJvci5uYW1lID09PSAnQ29uc3RyYWludE5vdFNhdGlzZmllZEVycm9yJykge1xyXG4vLyAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignVGhlIGNvbnN0cmFpbnRzIGFyZSBub3Qgc3VwcG9ydGVkICcsIGNvbnN0cmFpbnRzKTtcclxuLy8gICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvci5uYW1lID09PSAnUGVybWlzc2lvbkRlbmllZEVycm9yJykge1xyXG4vLyAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcclxuLy8gICAgICAgICAgICAgICAgICAgICAnUGVybWlzc2lvbnMgaGF2ZSBub3QgYmVlbiBncmFudGVkIHRvIHVzZSB5b3VyIGNhbWVyYSBhbmQgJyArXHJcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICdtaWNyb3Bob25lLCB5b3UgbmVlZCB0byBhbGxvdyB0aGUgcGFnZSBhY2Nlc3MgdG8geW91ciBkZXZpY2VzIGluICcgK1xyXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAnb3JkZXIgZm9yIHRoZSBkZW1vIHRvIHdvcmsuJyxcclxuLy8gICAgICAgICAgICAgICAgICk7XHJcbi8vICAgICAgICAgICAgIH1cclxuLy8gICAgICAgICAgICAgY29uc29sZS5lcnJvcignZ2V0VXNlck1lZGlhIGVycm9yOiAnICsgZXJyb3IubmFtZSwgZXJyb3IpO1xyXG4vLyAgICAgICAgIH0pO1xyXG4vLyB9IGVsc2Uge1xyXG4vLyAgICAgY29uc29sZS5sb2coJ2dldFVzZXJNZWRpYSgpIGlzIG5vdCBzdXBwb3J0ZWQgYnkgeW91ciBicm93c2VyJyk7XHJcbi8vIH1cclxuIiwiaW1wb3J0ICdub3JtYWxpemUuY3NzJztcclxuaW1wb3J0ICcuLi9jc3MvbWFpbi5jc3MnO1xyXG5cclxuaW1wb3J0IHsgbG9nVG9Eb20gfSBmcm9tICcuL2hlbHBlcnMnO1xyXG5cclxuaW1wb3J0IHsgTWVkaWFBY2Nlc3MgfSBmcm9tICcuL01lZGlhQWNjZXNzJztcclxuXHJcbmNvbnN0IHZpZGVvOiBIVE1MVmlkZW9FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnZpZGVvJyk7XHJcbmNvbnN0IGxvZ1RleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9nJyk7XHJcbmNvbnN0IGNhbWVyYVN3aXRjaEJ0bjogSFRNTEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3dpdGNoLWNhbWVyYScpO1xyXG5cclxuYXN5bmMgZnVuY3Rpb24gc3RhcnQoKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IG1lZGlhQWNjZXNzID0gbmV3IE1lZGlhQWNjZXNzKHZpZGVvKTtcclxuICAgICAgICBjb25zdCBwZXJtaXNzaW9uID0gYXdhaXQgbWVkaWFBY2Nlc3MuZ2V0Q2FtZXJhUGVybWlzc2lvbigpO1xyXG4gICAgICAgIC8vIEVuYWJsZS9zaG93IGJ1dHRvbiBpZiBwZXJtaXNzaW9uXHJcbiAgICAgICAgY2FtZXJhU3dpdGNoQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgZXZ0ID0+IHtcclxuICAgICAgICAgICAgLy8gZGlzYWJsZS9zcGluIGJ1dHRvbiB3aGlsZSB3YWl0aW5nXHJcbiAgICAgICAgICAgIGF3YWl0IG1lZGlhQWNjZXNzLnNlbGVjdE5leHRDYW1lcmEoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhlKTtcclxuICAgICAgICBsb2dUb0RvbSgnZXhjJyArIGUsIGxvZ1RleHQpO1xyXG4gICAgfVxyXG59XHJcblxyXG5zdGFydCgpO1xyXG4iXSwic291cmNlUm9vdCI6IiJ9