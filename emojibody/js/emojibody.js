!function(r){var n={};function i(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.m=r,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/js/",i(i.s=2)}([function(e,t,r){},function(e,t,r){},function(e,t,r){"use strict";r.r(t);r(0),r(1);function o(e,t){t.appendChild(document.createTextNode(e)),t.appendChild(document.createElement("br"))}var n=function(o,s,a,c){return new(a||(a=Promise))(function(e,t){function r(e){try{i(c.next(e))}catch(e){t(e)}}function n(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((c=c.apply(o,s||[])).next())})},s=function(r,n){var i,o,s,e,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&t[0]?o.return:t[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,t[1])).done)return s;switch(o=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,o=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){a.label=t[1];break}if(6===t[0]&&a.label<s[1]){a.label=s[1],s=t;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(t);break}s[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(r,a)}catch(e){t=[6,e],o=0}finally{i=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},a=document.getElementById("log"),c=function(){function e(e){this.hasGetUserMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia),this.hasCameraAccess=!1,this.devices=null,this.currentDevice=-1,this.videoElem=e}return e.prototype.getCameras=function(){return n(this,void 0,void 0,function(){var t;return s(this,function(e){switch(e.label){case 0:if(!this.hasGetUserMedia)throw"Your browser doesn't support media access. Please use iOS Safari or Android Chrome.";e.label=1;case 1:return e.trys.push([1,3,,4]),[4,navigator.mediaDevices.enumerateDevices()];case 2:return t=e.sent(),this.devices=t.filter(function(e){return"videoinput"===e.kind}),[2,this.devices];case 3:throw e.sent();case 4:return[2]}})})},e.prototype.getCameraPermission=function(){return n(this,void 0,void 0,function(){var t,r,n,i=this;return s(this,function(e){switch(e.label){case 0:if(!this.hasGetUserMedia)throw"Your browser doesn't support media access. Please use iOS Safari or Android Chrome.";e.label=1;case 1:return e.trys.push([1,5,,6]),this.devices?[3,3]:[4,this.getCameras()];case 2:e.sent(),e.label=3;case 3:return null===this.devices||0===this.devices.length?(o("No cameras available",a),[2,null]):(t={video:{deviceId:{exact:this.devices[0].deviceId}},audio:!1},r=this,[4,navigator.mediaDevices.getUserMedia(t)]);case 4:return r.currentStream=e.sent(),this.currentDevice=0,this.videoElem.srcObject=this.currentStream,this.videoElem.onloadedmetadata=function(){i.cameraResolution={width:i.videoElem.videoWidth,height:i.videoElem.videoHeight}},[2,!0];case 5:throw n=e.sent(),console.error("getUserMedia error: "+n.name,n),"ConstraintNotSatisfiedError"===n.name?"The constraints are not supported":"PermissionDeniedError"===n.name||"NotAllowedError"===n.name?"User denied camera use ðŸ˜’":n;case 6:return[2]}})})},e.prototype.stopCurrentStream=function(){this.currentStream&&(this.currentStream.getVideoTracks().forEach(function(e){e.stop()}),this.videoElem.srcObject=null)},e.prototype.selectNextCamera=function(){return n(this,void 0,void 0,function(){var t,r,n,i=this;return s(this,function(e){switch(e.label){case 0:if(!this.hasGetUserMedia)throw"Your browser doesn't support media access. Please use iOS Safari or Android Chrome.";if(this.devices.length<2)throw"There's only one camera, can't switch";e.label=1;case 1:return e.trys.push([1,3,,4]),this.currentDevice=(this.currentDevice+1)%this.devices.length,t={video:{deviceId:{exact:this.devices[this.currentDevice].deviceId}},audio:!1},this.stopCurrentStream(),r=this,[4,navigator.mediaDevices.getUserMedia(t)];case 2:return r.currentStream=e.sent(),this.videoElem.srcObject=this.currentStream,this.videoElem.onloadedmetadata=function(){i.cameraResolution={width:i.videoElem.videoWidth,height:i.videoElem.videoHeight}},[2,!0];case 3:throw n=e.sent(),console.error("getUserMedia error: "+n.name,n),"ConstraintNotSatisfiedError"===n.name?"The constraints are not supported":"PermissionDeniedError"===n.name||"NotAllowedError"===n.name?"User denied camera use ðŸ˜’":n;case 4:return[2]}})})},e}(),u=function(o,s,a,c){return new(a||(a=Promise))(function(e,t){function r(e){try{i(c.next(e))}catch(e){t(e)}}function n(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((c=c.apply(o,s||[])).next())})},l=function(r,n){var i,o,s,e,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&t[0]?o.return:t[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,t[1])).done)return s;switch(o=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,o=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){a.label=t[1];break}if(6===t[0]&&a.label<s[1]){a.label=s[1],s=t;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(t);break}s[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(r,a)}catch(e){t=[6,e],o=0}finally{i=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},d=document.querySelector(".video"),h=document.getElementById("log"),f=document.querySelector(".intro-text"),v=document.querySelector(".switch-camera");!function(){u(this,void 0,void 0,function(){var t,r,n,i=this;return l(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,(t=new c(d)).getCameraPermission()];case 1:return e.sent()?(f.innerHTML="Now focus on some body parts ðŸ’ª ðŸ‘±",[4,t.getCameras()]):(f.innerHTML="User denied camera use ðŸ˜’",[2]);case 2:return(r=e.sent())&&1<r.length?v.addEventListener("click",function(e){return u(i,void 0,void 0,function(){return l(this,function(e){switch(e.label){case 0:return d.classList.add("switching"),[4,function(r){return new Promise(function(e,t){return setTimeout(e,r)})}(400)];case 1:return e.sent(),[4,t.selectNextCamera()];case 2:return e.sent(),d.classList.remove("switching"),[2]}})})}):v.classList.add("hidden"),[3,4];case 3:return n=e.sent(),console.log(n),o("Error: "+n,h),d.classList.remove("switching"),[3,4];case 4:return[2]}})})}()}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2pzL2hlbHBlcnMudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2pzL01lZGlhQWNjZXNzLnRzIiwid2VicGFjazovLy8uL3NyYy9qcy9pbmRleC50cyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsImxvZ1RvRG9tIiwidGV4dCIsImVsZW0iLCJhcHBlbmRDaGlsZCIsImRvY3VtZW50IiwiY3JlYXRlVGV4dE5vZGUiLCJjcmVhdGVFbGVtZW50IiwibG9nVGV4dCIsImdldEVsZW1lbnRCeUlkIiwiTWVkaWFBY2Nlc3NfTWVkaWFBY2Nlc3MiLCJNZWRpYUFjY2VzcyIsInZpZGVvIiwidGhpcyIsImhhc0dldFVzZXJNZWRpYSIsIm5hdmlnYXRvciIsIm1lZGlhRGV2aWNlcyIsImdldFVzZXJNZWRpYSIsImhhc0NhbWVyYUFjY2VzcyIsImRldmljZXMiLCJjdXJyZW50RGV2aWNlIiwidmlkZW9FbGVtIiwiZ2V0Q2FtZXJhcyIsImVudW1lcmF0ZURldmljZXMiLCJfYSIsInNlbnQiLCJmaWx0ZXIiLCJkZXZpY2UiLCJraW5kIiwiZ2V0Q2FtZXJhUGVybWlzc2lvbiIsIl9iIiwibGVuZ3RoIiwiY29uc3RyYWludHMiLCJkZXZpY2VJZCIsImV4YWN0IiwiYXVkaW8iLCJjdXJyZW50U3RyZWFtIiwic3JjT2JqZWN0Iiwib25sb2FkZWRtZXRhZGF0YSIsIl90aGlzIiwiY2FtZXJhUmVzb2x1dGlvbiIsIndpZHRoIiwidmlkZW9XaWR0aCIsImhlaWdodCIsInZpZGVvSGVpZ2h0IiwiY29uc29sZSIsImVycm9yIiwiZXJyXzEiLCJzdG9wQ3VycmVudFN0cmVhbSIsImdldFZpZGVvVHJhY2tzIiwiZm9yRWFjaCIsInRyYWNrIiwic3RvcCIsInNlbGVjdE5leHRDYW1lcmEiLCJlcnJfMiIsInF1ZXJ5U2VsZWN0b3IiLCJqc19sb2dUZXh0IiwiaW50cm9UZXh0IiwiY2FtZXJhU3dpdGNoQnRuIiwibWVkaWFBY2Nlc3NfMSIsImlubmVySFRNTCIsImNhbWVyYXMiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZ0IiwianNfYXdhaXRlciIsImNsYXNzTGlzdCIsImFkZCIsIm1zIiwiUHJvbWlzZSIsImoiLCJzZXRUaW1lb3V0Iiwid2FpdCIsInJlbW92ZSIsImxvZyIsImVfMSIsInN0YXJ0Il0sIm1hcHBpbmdzIjoiYUFDQSxJQUFBQSxFQUFBLEdBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVBQUFFLEdBQUFDLFFBR0EsSUFBQUMsRUFBQUosRUFBQUUsR0FBQSxDQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFFBQUEsSUFVQSxPQU5BSSxFQUFBTCxHQUFBTSxLQUFBSixFQUFBRCxRQUFBQyxJQUFBRCxRQUFBRixHQUdBRyxFQUFBRSxHQUFBLEVBR0FGLEVBQUFELFFBS0FGLEVBQUFRLEVBQUFGLEVBR0FOLEVBQUFTLEVBQUFWLEVBR0FDLEVBQUFVLEVBQUEsU0FBQVIsRUFBQVMsRUFBQUMsR0FDQVosRUFBQWEsRUFBQVgsRUFBQVMsSUFDQUcsT0FBQUMsZUFBQWIsRUFBQVMsRUFBQSxDQUEwQ0ssWUFBQSxFQUFBQyxJQUFBTCxLQUsxQ1osRUFBQWtCLEVBQUEsU0FBQWhCLEdBQ0Esb0JBQUFpQixlQUFBQyxhQUNBTixPQUFB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LEVBQVlyQyxnQkFMOUJtQyxFQUFVRyxVQUFZLDRCQUN0QixtQkFJRUMsRUFBVXJDLEVBQUFDLFNBQ2dCLEVBQWpCb0MsRUFBUTlCLE9BQ25CMkIsRUFBZ0JJLGlCQUFpQixRQUFTLFNBQU1DLEdBQUcsT0FBQUMsRUFBQXpCLE9BQUEscUVBRy9DLE9BREEzQixFQUFNcUQsVUFBVUMsSUFBSSxhQUNwQixHRnRCSSxTQUFDQyxHQUFlLFdBQUlDLFFBQVEsU0FBQ3JGLEVBQUdzRixHQUFNLE9BQUFDLFdBQVd2RixFQUFHb0YsS0VzQmxESSxDQUFLLGFBQ1gsT0FEQS9DLEVBQUFDLE9BQ0EsR0FBTWtDLEVBQVlOLGtDQUFsQjdCLEVBQUFDLE9BQ0FiLEVBQU1xRCxVQUFVTyxPQUFPLHdCQUkzQmQsRUFBZ0JPLFVBQVVDLElBQUkseUNBR2xDckIsUUFBUTRCLElBQUlDLEdBQ1p6RSxFQUFTLFVBQVl5RSxFQUFHbEIsR0FDeEI1QyxFQUFNcUQsVUFBVU8sT0FBTyx5Q0FJL0JHIiwiZmlsZSI6ImVtb2ppYm9keS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiL2pzL1wiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMik7XG4iLCJleHBvcnQgZnVuY3Rpb24gbG9nVG9Eb20odGV4dDogc3RyaW5nLCBlbGVtOiBIVE1MRWxlbWVudCkge1xyXG4gICAgZWxlbS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0KSk7XHJcbiAgICBlbGVtLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2JyJykpO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3Qgd2FpdCA9IChtczogbnVtYmVyKSA9PiBuZXcgUHJvbWlzZSgociwgaikgPT4gc2V0VGltZW91dChyLCBtcykpO1xyXG4iLCJpbXBvcnQgeyBsb2dUb0RvbSB9IGZyb20gJy4vaGVscGVycyc7XHJcblxyXG5jb25zdCBsb2dUZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZycpO1xyXG5cclxuZXhwb3J0IGNsYXNzIE1lZGlhQWNjZXNzIHtcclxuICAgIC8vIFRydWUgaWYgYnJvd3NlciBpcyBjb21wYXRpYmxlXHJcbiAgICBwdWJsaWMgaGFzR2V0VXNlck1lZGlhOiBib29sZWFuO1xyXG4gICAgLy8gVHJ1ZSBpcyB1c2VyIGhhcyBncmFudGVkIGFjY2Vzc1xyXG4gICAgcHVibGljIGhhc0NhbWVyYUFjY2VzczogYm9vbGVhbjtcclxuXHJcbiAgICAvLyBMaXN0IG9mIGNhbWVyYXMgYXZhaWxhYmxlXHJcbiAgICBwcml2YXRlIGRldmljZXM6IGFueVtdO1xyXG4gICAgLy8gSW5kZXggb2YgdGhlIGFjdGl2ZSBjYW1lcmFcclxuICAgIHByaXZhdGUgY3VycmVudERldmljZTogbnVtYmVyO1xyXG4gICAgLy8gQ3VycmVudCBjYW1lcmEgcmVzb2x1dGlvbiwgb25seSBhdmFpbGFibGUgdW50aWwgc3RyZWFtIGlzIHBhc3NlZCB0byA8dmlkZW8+IGVsZW1lbnRcclxuICAgIHByaXZhdGUgY2FtZXJhUmVzb2x1dGlvbjogeyB3aWR0aDogbnVtYmVyOyBoZWlnaHQ6IG51bWJlciB9O1xyXG4gICAgLy8gQ3VycmVudCBhY3RpdmUgY2FtZXJhIHN0cmVhbVxyXG4gICAgcHJpdmF0ZSBjdXJyZW50U3RyZWFtOiBNZWRpYVN0cmVhbTtcclxuICAgIC8vIFZpZGVvIEhUTUwgZWxlbWVudCBpbiB3aGljaCB0byBvdXRwdXQgdGhlIHN0cmVhbVxyXG4gICAgcHJpdmF0ZSB2aWRlb0VsZW06IEhUTUxWaWRlb0VsZW1lbnQ7XHJcblxyXG4gICAgcHVibGljIGNvbnN0cnVjdG9yKHZpZGVvOiBIVE1MVmlkZW9FbGVtZW50KSB7XHJcbiAgICAgICAgdGhpcy5oYXNHZXRVc2VyTWVkaWEgPSAhIShuYXZpZ2F0b3IubWVkaWFEZXZpY2VzICYmIG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKTtcclxuICAgICAgICB0aGlzLmhhc0NhbWVyYUFjY2VzcyA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuZGV2aWNlcyA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50RGV2aWNlID0gLTE7XHJcbiAgICAgICAgdGhpcy52aWRlb0VsZW0gPSB2aWRlbztcclxuICAgIH1cclxuXHJcbiAgICAvKlxyXG4gICAgICogR2V0IHRoZSBhdmFpbGFibGUgY2FtZXJhcyBpbiB0aGUgc3lzdGVtXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBhc3luYyBnZXRDYW1lcmFzKCk6IFByb21pc2U8TWVkaWFEZXZpY2VJbmZvW10+IHtcclxuICAgICAgICBpZiAoIXRoaXMuaGFzR2V0VXNlck1lZGlhKSB7XHJcbiAgICAgICAgICAgIHRocm93ICdZb3VyIGJyb3dzZXIgZG9lc25cXCd0IHN1cHBvcnQgbWVkaWEgYWNjZXNzLiBQbGVhc2UgdXNlIGlPUyBTYWZhcmkgb3IgQW5kcm9pZCBDaHJvbWUuJztcclxuICAgICAgICB9XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgZGV2aWNlcyA9IGF3YWl0IG5hdmlnYXRvci5tZWRpYURldmljZXMuZW51bWVyYXRlRGV2aWNlcygpO1xyXG4gICAgICAgICAgICB0aGlzLmRldmljZXMgPSBkZXZpY2VzLmZpbHRlcihkZXZpY2UgPT4gZGV2aWNlLmtpbmQgPT09ICd2aWRlb2lucHV0Jyk7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRldmljZXM7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICB0aHJvdyBlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKlxyXG4gICAgICogQXNrcyB0aGUgdXNlciBmb3IgYWNjZXNzIHRvIHRoZSBjYW1lcmEocykuIElmIGdyYW50ZWQsIHNlbGVjdHMgdGhlIDFzdCBjYW1lcmEgaW4gdGhlIGxpc3Qgb2YgZGV2aWNlcy5cclxuICAgICAqL1xyXG4gICAgcHVibGljIGFzeW5jIGdldENhbWVyYVBlcm1pc3Npb24oKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmhhc0dldFVzZXJNZWRpYSkge1xyXG4gICAgICAgICAgICB0aHJvdyAnWW91ciBicm93c2VyIGRvZXNuXFwndCBzdXBwb3J0IG1lZGlhIGFjY2Vzcy4gUGxlYXNlIHVzZSBpT1MgU2FmYXJpIG9yIEFuZHJvaWQgQ2hyb21lLic7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5kZXZpY2VzKSB7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmdldENhbWVyYXMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5kZXZpY2VzID09PSBudWxsIHx8IHRoaXMuZGV2aWNlcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgIGxvZ1RvRG9tKCdObyBjYW1lcmFzIGF2YWlsYWJsZScsIGxvZ1RleHQpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFNlbGVjdCAxc3QgY2FtZXJhIGluIGxpc3Qgb2YgZGV2aWNlc1xyXG4gICAgICAgICAgICBjb25zdCBjb25zdHJhaW50cyA9IHtcclxuICAgICAgICAgICAgICAgIHZpZGVvOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGV2aWNlSWQ6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXhhY3Q6IHRoaXMuZGV2aWNlc1swXS5kZXZpY2VJZCxcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGF1ZGlvOiBmYWxzZSxcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFN0cmVhbSA9IGF3YWl0IG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKGNvbnN0cmFpbnRzKTtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50RGV2aWNlID0gMDtcclxuICAgICAgICAgICAgdGhpcy52aWRlb0VsZW0uc3JjT2JqZWN0ID0gdGhpcy5jdXJyZW50U3RyZWFtO1xyXG4gICAgICAgICAgICAvLyBXZSBjYW4gb25seSBrbm93IHRoZSByZXNvbHV0aW9uIHdoZW4gd2UgcGFzcyB0aGUgc3RyZWFtIHRvIHRoZSA8dmlkZW8+IGVsZW1lbnRcclxuICAgICAgICAgICAgdGhpcy52aWRlb0VsZW0ub25sb2FkZWRtZXRhZGF0YSA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2FtZXJhUmVzb2x1dGlvbiA9IHsgd2lkdGg6IHRoaXMudmlkZW9FbGVtLnZpZGVvV2lkdGgsIGhlaWdodDogdGhpcy52aWRlb0VsZW0udmlkZW9IZWlnaHQgfTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ2dldFVzZXJNZWRpYSBlcnJvcjogJyArIGVyci5uYW1lLCBlcnIpO1xyXG4gICAgICAgICAgICBpZiAoZXJyLm5hbWUgPT09ICdDb25zdHJhaW50Tm90U2F0aXNmaWVkRXJyb3InKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyAnVGhlIGNvbnN0cmFpbnRzIGFyZSBub3Qgc3VwcG9ydGVkJztcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChlcnIubmFtZSA9PT0gJ1Blcm1pc3Npb25EZW5pZWRFcnJvcicgfHwgZXJyLm5hbWUgPT09ICdOb3RBbGxvd2VkRXJyb3InKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyAnVXNlciBkZW5pZWQgY2FtZXJhIHVzZSDwn5iSJztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRocm93IGVycjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKlxyXG4gICAgICogTmVlZGVkIGRlaW5pdGlhbGl6YXRpb24gZm9yIGNhbWVyYSBzd2l0Y2hcclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0b3BDdXJyZW50U3RyZWFtKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRTdHJlYW0pIHtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50U3RyZWFtLmdldFZpZGVvVHJhY2tzKCkuZm9yRWFjaCh0cmFjayA9PiB7XHJcbiAgICAgICAgICAgICAgICB0cmFjay5zdG9wKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLnZpZGVvRWxlbS5zcmNPYmplY3QgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKlxyXG4gICAgICogU2VsZWN0cyBuZXh0IGNhbWVyYSBvbiB0aGUgbGlzdFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgYXN5bmMgc2VsZWN0TmV4dENhbWVyYSgpOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICAgICAgICBpZiAoIXRoaXMuaGFzR2V0VXNlck1lZGlhKSB7XHJcbiAgICAgICAgICAgIHRocm93ICdZb3VyIGJyb3dzZXIgZG9lc25cXCd0IHN1cHBvcnQgbWVkaWEgYWNjZXNzLiBQbGVhc2UgdXNlIGlPUyBTYWZhcmkgb3IgQW5kcm9pZCBDaHJvbWUuJztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuZGV2aWNlcy5sZW5ndGggPCAyKSB7XHJcbiAgICAgICAgICAgIHRocm93IFwiVGhlcmUncyBvbmx5IG9uZSBjYW1lcmEsIGNhbid0IHN3aXRjaFwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAvLyBOZXh0IGNhbWVyYSBhdmFpbGFibGVcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50RGV2aWNlID0gKHRoaXMuY3VycmVudERldmljZSArIDEpICUgdGhpcy5kZXZpY2VzLmxlbmd0aDtcclxuICAgICAgICAgICAgY29uc3QgY29uc3RyYWludHMgPSB7XHJcbiAgICAgICAgICAgICAgICB2aWRlbzoge1xyXG4gICAgICAgICAgICAgICAgICAgIGRldmljZUlkOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4YWN0OiB0aGlzLmRldmljZXNbdGhpcy5jdXJyZW50RGV2aWNlXS5kZXZpY2VJZCxcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGF1ZGlvOiBmYWxzZSxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5zdG9wQ3VycmVudFN0cmVhbSgpO1xyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRTdHJlYW0gPSBhd2FpdCBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYShjb25zdHJhaW50cyk7XHJcbiAgICAgICAgICAgIC8vICh3aW5kb3cgYXMgYW55KS5zdHJlYW0gPSBjdXJyZW50U3RyZWFtOyAvLyBtYWtlIHZhcmlhYmxlIGF2YWlsYWJsZSB0byBicm93c2VyIGNvbnNvbGVcclxuICAgICAgICAgICAgdGhpcy52aWRlb0VsZW0uc3JjT2JqZWN0ID0gdGhpcy5jdXJyZW50U3RyZWFtO1xyXG4gICAgICAgICAgICAvLyBXZSBjYW4gb25seSBrbm93IHRoZSByZXNvbHV0aW9uIHdoZW4gd2UgcGFzcyB0aGUgc3RyZWFtIHRvIHRoZSA8dmlkZW8+IGVsZW1lbnRcclxuICAgICAgICAgICAgdGhpcy52aWRlb0VsZW0ub25sb2FkZWRtZXRhZGF0YSA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2FtZXJhUmVzb2x1dGlvbiA9IHsgd2lkdGg6IHRoaXMudmlkZW9FbGVtLnZpZGVvV2lkdGgsIGhlaWdodDogdGhpcy52aWRlb0VsZW0udmlkZW9IZWlnaHQgfTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ2dldFVzZXJNZWRpYSBlcnJvcjogJyArIGVyci5uYW1lLCBlcnIpO1xyXG4gICAgICAgICAgICBpZiAoZXJyLm5hbWUgPT09ICdDb25zdHJhaW50Tm90U2F0aXNmaWVkRXJyb3InKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyAnVGhlIGNvbnN0cmFpbnRzIGFyZSBub3Qgc3VwcG9ydGVkJztcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChlcnIubmFtZSA9PT0gJ1Blcm1pc3Npb25EZW5pZWRFcnJvcicgfHwgZXJyLm5hbWUgPT09ICdOb3RBbGxvd2VkRXJyb3InKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyAnVXNlciBkZW5pZWQgY2FtZXJhIHVzZSDwn5iSJztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRocm93IGVycjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJpbXBvcnQgJ25vcm1hbGl6ZS5jc3MnO1xyXG5pbXBvcnQgJy4uL2Nzcy9tYWluLmNzcyc7XHJcblxyXG5pbXBvcnQgeyBsb2dUb0RvbSwgd2FpdCB9IGZyb20gJy4vaGVscGVycyc7XHJcblxyXG5pbXBvcnQgeyBNZWRpYUFjY2VzcyB9IGZyb20gJy4vTWVkaWFBY2Nlc3MnO1xyXG5cclxuY29uc3QgdmlkZW86IEhUTUxWaWRlb0VsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudmlkZW8nKTtcclxuY29uc3QgbG9nVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2cnKTtcclxuY29uc3QgaW50cm9UZXh0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmludHJvLXRleHQnKTtcclxuY29uc3QgY2FtZXJhU3dpdGNoQnRuOiBIVE1MRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zd2l0Y2gtY2FtZXJhJyk7XHJcblxyXG5hc3luYyBmdW5jdGlvbiBzdGFydCgpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgbWVkaWFBY2Nlc3MgPSBuZXcgTWVkaWFBY2Nlc3ModmlkZW8pO1xyXG4gICAgICAgIGNvbnN0IHBlcm1pc3Npb24gPSBhd2FpdCBtZWRpYUFjY2Vzcy5nZXRDYW1lcmFQZXJtaXNzaW9uKCk7XHJcbiAgICAgICAgaWYgKCFwZXJtaXNzaW9uKSB7XHJcbiAgICAgICAgICAgIGludHJvVGV4dC5pbm5lckhUTUwgPSAnVXNlciBkZW5pZWQgY2FtZXJhIHVzZSDwn5iSJztcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpbnRyb1RleHQuaW5uZXJIVE1MID0gJ05vdyBmb2N1cyBvbiBzb21lIGJvZHkgcGFydHMg8J+SqiDwn5GxJztcclxuXHJcbiAgICAgICAgY29uc3QgY2FtZXJhcyA9IGF3YWl0IG1lZGlhQWNjZXNzLmdldENhbWVyYXMoKTtcclxuICAgICAgICBpZiAoY2FtZXJhcyAmJiBjYW1lcmFzLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgICAgY2FtZXJhU3dpdGNoQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgZXZ0ID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIGRpc2FibGUvc3BpbiBidXR0b24gd2hpbGUgd2FpdGluZ1xyXG4gICAgICAgICAgICAgICAgdmlkZW8uY2xhc3NMaXN0LmFkZCgnc3dpdGNoaW5nJyk7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCB3YWl0KDQwMCk7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBtZWRpYUFjY2Vzcy5zZWxlY3ROZXh0Q2FtZXJhKCk7XHJcbiAgICAgICAgICAgICAgICB2aWRlby5jbGFzc0xpc3QucmVtb3ZlKCdzd2l0Y2hpbmcnKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gSGlkZSBidXR0b24gaWYgdGhlcmUncyBvbmx5IG9uZSBjYW1lcmEuXHJcbiAgICAgICAgICAgIGNhbWVyYVN3aXRjaEJ0bi5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTtcclxuICAgICAgICB9XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coZSk7XHJcbiAgICAgICAgbG9nVG9Eb20oJ0Vycm9yOiAnICsgZSwgbG9nVGV4dCk7XHJcbiAgICAgICAgdmlkZW8uY2xhc3NMaXN0LnJlbW92ZSgnc3dpdGNoaW5nJyk7XHJcbiAgICB9XHJcbn1cclxuXHJcbnN0YXJ0KCk7XHJcbiJdLCJzb3VyY2VSb290IjoiIn0=